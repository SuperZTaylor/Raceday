<html>
  <head>
    <title>Raceday Sorter</title>
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
  </head>
  <body>
    
    <section class="controls">
      <div class="inputContainer">
      <img class="logo" src="images/logoFlipside.png">
      <div class="inputHolder">
        <label for="name">Name</label>
        <input id="name" type="text">
      </div>
      <div class="inputHolder">
        <label for="points">Points</label>
        <input id="points" class="ctrlInputs" type="text">
      </div>
      <div class="inputHolder">
        <label for="minute">Time</label>
        <div>
          <input id="minute" type="text" placeholder="min">
          <input id="second" type="text" min="0" max="59" placeholder="sec">
          <input id="milisecond" type="text" placeholder="mili">
        </div>
      </div>
      <div class="inputHolder">
        <label for="stage">Stage</label>
        <input id="stage" class="ctrlInputs" type="text">
      </div>
      </div>
      <section class="btnContainer">
      <button id="submit">Submit</button>
      <button id="speedBtn">Speed Input</button>
      <button id="deleteBtn">Delete Results</button>
      </section>
      
    </section>
    <section class="container">
      
      <div class="searchContainer">
        <select id="class">
          <option>Advanced Class</option>
          <option>Regular Class</option>
        </select>
        <select id="list">
          <option>Overall</option>
          <option>N/A</option>
          <option>Stage 1</option>
          <option>Stage 2</option>
          <option>Stage 3</option>
          <option>Stage 4</option>
          <option>Stage 5</option>
          <option>Stage 6</option>
          <option>Stage 7</option>
          <option>Stage 8</option>
          <option>Stage 9</option>
          <option>Stage 10</option>
        </select>
        <input id="searchBar" type="search">
        <button class="search">Search</button>
      </div>
      
      <div class="overallContainer"><h1 class="containerHeader">Overall</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
      <div class="stage0Container stageContainer"><h1 class="containerHeader">N/A</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
      <div class="stage1Container stageContainer"><h1 class="containerHeader">Stage 1</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
      <div class="stage2Container stageContainer"><h1 class="containerHeader">Stage 2</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
      <div class="stage3Container stageContainer"><h1 class="containerHeader">Stage 3</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
      <div class="stage4Container stageContainer"><h1 class="containerHeader">Stage 4</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
      <div class="stage5Container stageContainer"><h1 class="containerHeader">Stage 5</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
      <div class="stage6Container stageContainer"><h1 class="containerHeader">Stage 6</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
      <div class="stage7Container stageContainer"><h1 class="containerHeader">Stage 7</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
      <div class="stage8Container stageContainer"><h1 class="containerHeader">Stage 8</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
      <div class="stage9Container stageContainer"><h1 class="containerHeader">Stage 9</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
      <div class="stage10Container stageContainer"><h1 class="containerHeader">Stage 10</h1>
        <h1 class="description"><span class="descName">Name</span><span class="descPoints">Points</span><span class="descTime">Time</span><span class="descStage">Stage</span></h1>
        <ol></ol></div>
    </section>
  
  
    <script>
      var unOverall = {};
      var overallStats = {};
      var names = [];
      var speedInput = false;
      
      getPastUsers();
      changeList();
      
      function toggleSpeed(){
        if(speedInput == false){
          speedInput = true;
          alert("Type 'done' or 'exit' at any point to exit speed input. Speed Input allows you to enter students without using the mouse to swap inputs.")
        }
        else if(speedInput == true){
          speedInput = false;
        }
      }
      
      
      $("#speedBtn").click(toggleSpeed);
      $("#speedBtn").click(getUser)
      
      function getUser(){
        var name = $("#name").val();
        var point = $("#points").val();
        var minute = $("#minute").val();
        var second = $("#second").val();
        var milisecond = $("#milisecond").val();
        var stage = $("#stage").val();
        
        if(speedInput == true){
          name = prompt("What is the NAME?");
          if(name == "done" || name == "exit" || name == "Done" || name == "Exit"){toggleSpeed(); return}
          point = prompt("What is the POINTS?");
          if(point == "done" || point == "exit" || point == "Done" || point == "Exit"){toggleSpeed(); return}
          minute = prompt("What is the MINUTE?");
          if(minute == "done" || minute == "exit" || minute == "Done" || minute == "Exit"){toggleSpeed(); return}
          second = prompt("What is the SECOND?");
          if(second == "done" || second == "exit" || second == "Done" || second == "Exit"){toggleSpeed(); return}
          milisecond = prompt("What is the MILISECOND?");
          if(milisecond == "done" || milisecond == "escape" || milisecond == "Done" || milisecond == "Escape"){toggleSpeed(); return}
          stage = prompt("What is the STAGE?");
          if(stage == "done" || stage == "escape" || stage == "Done" || stage == "Escape"){toggleSpeed(); return}
        }
        
        if(point <= 9){point = "0" + point}
        if(minute == "" || minute == "0"){minute = "0"}
        if(second == "" || second == "0"){second = "00"}
        if(milisecond == "" || milisecond == "0"){milisecond = "00";}
        point.split(".").join("");
        if(isNaN(point)){
          alert("Points must be a number!")
          if(speedInput == true){toggleSpeed()}
          return
        }
        if(second <= 9 && second != 0){
          second = "0" + second;
        }
        if(milisecond <= 9 && milisecond != 0){
          milisecond = "0" + milisecond;
        }
        
        if(minute >= 10 || second >= 60 || milisecond >= 100){
          alert("You cannot input a time that large!");
          if(speedInput == true){toggleSpeed()}
          return
        }
        if(isNaN(minute) || isNaN(second) || isNaN(milisecond) || minute.includes(".") || second.includes(".") || milisecond.includes(".")){
          alert("Time needs to be a number!");
          if(speedInput == true){toggleSpeed()}
          return
        }
        if(stage.includes(".")){
          alert("Stage needs to be a number!");
          if(speedInput == true){toggleSpeed()}
          return
        }
        if(point >= 100){
          alert("You cannot have that many points inputed!");
          if(speedInput == true){toggleSpeed()}
          return
        }
        if(stage == "N/A" || stage == "n/a" || stage == ""){
          stage = "0";
        }
          if(stage <= 10){}
        else{alert("Stage is not a number!");
            if(speedInput == true){toggleSpeed()}
            return}
        
        
        var time = minute + second + milisecond;

        
        if(name == ""){
          alert("Fill out name!")
          if(speedInput == true){
            toggleSpeed()
          }
          return
        }
        if(stage == "" || stage <= -1){
          alert("Stage is too small!")
          if(speedInput == true){
            toggleSpeed()
          }
          return
        }
        if(stage >= 11){
          alert("Stage number is above 10!")
          if(speedInput == true){
            toggleSpeed()
          }
          return
        }
        var encoded = point + time + stage;
        
        
        unOverall[name] = encoded;
        sortOverall();
      }
      
      $("#submit").click(getUser);
      
      function sortOverall(){
        overallStats = Object.fromEntries(
        Object.entries(unOverall).sort(([,a],[,b]) => b- a)
);
        names = Object.keys(overallStats);
        addUser()
      }
      
      
      
      function addUser(){
        $(".user").remove();
        var name;
        var num = 0;
        var loopNum = names.length;
        loopNum -= 1;
        for(loopNum in names){
          name = names[num]
          var encoded = overallStats[name];
          var points = encoded.charAt(0) + encoded.charAt(1);
          if(encoded.charAt(0) == 0){
            points = encoded.charAt(1);
          }
          var time = encoded.charAt(2) + encoded.charAt(3) + encoded.charAt(4) + encoded.charAt(5) + encoded.charAt(6);
          var minute = encoded.charAt(2);
          var second = encoded.charAt(3) + encoded.charAt(4);
          var milisecond = encoded.charAt(5) + encoded.charAt(6);
          var stage = encoded.charAt(7);
          if(encoded.charAt(8)){
            stage = encoded.charAt(7) + encoded.charAt(8);
          }
          if(encoded.charAt(7) == 0){
            stage = "N/A"
          }
          time = minute + ":" + second + "." + milisecond;
          num +=1;
          var nameId = name.split(" ").join("");
          var code = '<div class="user"><li></li><h1 id="'+nameId+'">'+ name +'</h1><h1>'+ points +'</h1><h1>'+ time +'</h1><h1>'+ stage +'</h1></div>';
        $(".overallContainer > ol").append(code);
          code = '<div class="user"><li></li><h1 id="'+nameId+ stage +'">'+ name +'</h1><h1>'+ points +'</h1><h1>'+ time +'</h1><h1>'+ stage +'</h1></div>';
          if(stage == "N/A"){
            stage = "0"
          }
        $(".stage" + stage + "Container > ol").append(code);
        }
        if(speedInput == true){
          getUser()
        }
        var studentClass = $("#class").val();
        if(studentClass == "Advanced Class"){
          localStorage.setItem("race_unOverall_A",JSON.stringify(unOverall));
          localStorage.setItem("race_overallStats_A",JSON.stringify(overallStats));
          localStorage.setItem("race_names_A",JSON.stringify(names));
        }
        else{
          localStorage.setItem("race_unOverall",JSON.stringify(unOverall));
          localStorage.setItem("race_overallStats",JSON.stringify(overallStats));
          localStorage.setItem("race_names",JSON.stringify(names));
        }
      }
      
      function removeUsers(){
        var ques = confirm("Are you sure you want to delete all users? This CANNOT be undone!");
        if(ques){
          $(".user").remove();
          unOverall = {};
          overallStats = {};
          names = [];
          var studentClass = $("#class").val();
          if(studentClass == "Advanced Class"){
            localStorage.removeItem("race_unOverall_A")
            localStorage.removeItem("race_overallStats_A")
            localStorage.removeItem("race_names_A")
          }
          else{
            localStorage.removeItem("race_unOverall")
            localStorage.removeItem("race_overallStats")
            localStorage.removeItem("race_names")
          }
        }
        else{return}
      }
      
      $("#deleteBtn").click(removeUsers)
      
      function getPastUsers(){
        $(".user").remove()
         unOverall = {};
         overallStats = {};
         names = [];
        var unOverallStorage;
        var overallStatsStorage;
        var namesStorage;
        var studentClass = $("#class").val();
        if(studentClass == "Advanced Class"){
          unOverallStorage = JSON.parse(localStorage.getItem("race_unOverall_A"));
          overallStatsStorage = JSON.parse(localStorage.getItem("race_overallStats_A"));
          namesStorage = JSON.parse(localStorage.getItem("race_names_A"));
        }
        else{
          unOverallStorage = JSON.parse(localStorage.getItem("race_unOverall"));
          overallStatsStorage = JSON.parse(localStorage.getItem("race_overallStats"));
          namesStorage = JSON.parse(localStorage.getItem("race_names"));
        }
        if(overallStatsStorage == "" || overallStatsStorage == "null"){}
        else if(overallStatsStorage){unOverall = unOverallStorage;
        overallStats = overallStatsStorage;
        names = namesStorage;
        addUser()}
      }
      
      function changeList(){
        var stage = $("#list").val();
        if(stage == "Overall"){
          $(".stageContainer").hide();
          $(".overallContainer").show()
        }
        else{var list = stage.split(" ").join("");
             if(list == "N/A" || list == "n/a"){list = "stage0"}
        list = list.toLowerCase() + "Container";
        $(".overallContainer").hide();
        $(".stageContainer").hide();
        $("."+list).show();}
      }
      
      $("#list").change(changeList)
      
      function search(){
        var element;
        var name = $("#searchBar").val();
        var stage = $("#list").val()
        if(stage != "Overall"){
        name = name.split(" ").join("");
        stage = stage.split("Stage ").join("")
        element = document.getElementById(name + stage);
        element.scrollIntoView();
        }
        else{name = name.split(" ").join("");
        element = document.getElementById(name);
        element.scrollIntoView();}
        
      }
      
      $("#class").change(getPastUsers)
      $(".search").click(search); 
      
    </script>
  </body>

</html>
